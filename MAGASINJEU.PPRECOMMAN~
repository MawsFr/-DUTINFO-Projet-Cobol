       IDENTIFICATION DIVISION.
       PROGRAM-ID. PPRECOMMAN.
       AUTHOR. MUSTAPHA.
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT F-PRECOM ASSIGN TO DATABASE-PRECOMMAND
           ORGANIZATION INDEXED
           ACCESS DYNAMIC
           RECORD KEY IS REFPRECOMM OF E-PRECOM.
           SELECT F-ECRAN ASSIGN TO WORKSTATION-ECRAN
           ORGANIZATION TRANSACTION
           CONTROL-AREA VAR.
       DATA DIVISION.
       FILE SECTION.
       FD F-PRECOM.
       01 E-PRECOM.
       COPY DDS-PRECOMMAND OF PRECOMMAND.
       FD F-ECRAN.
       01 E-ECRAN.
       COPY DDS-ALL-FORMATS OF ECRAN.
       WORKING-STORAGE SECTION.
       01 VAR            PIC XX.
        88 F3 VALUE "03".
        88 F4 VALUE "04".
       77 DATESYSTEM     PIC X(16).
       77 INFOVALID      PIC 9.
       77 TROUVE         PIC 9.
       77 FINPROGRAMME   PIC 9 VALUE 0.
       PROCEDURE DIVISION.
       DEBUT.
           OPEN I-O F-ECRAN.
           PERFORM UNTIL FINPROGRAMME = 1
            IF FINPROGRAMME = 0
             PERFORM AFFICHMENU
            END-IF
           END-PERFORM.
           CLOSE F-ECRAN.
      *    STOP RUN.
           GOBACK.
       AFFICHMENU.
           INITIALIZE E-ECRAN
           INITIALIZE CHOIXMPREC
           PERFORM UNTIL (CHOIXMPREC > 0
           AND CHOIXMPREC < 3) OR CHOIXMPREC = 9
             IF FINPROGRAMME = 0
      *      DISPLAY 'J''ENTRE ICI'
             WRITE E-ECRAN FORMAT 'MPRECOMMAN' END-WRITE
             READ F-ECRAN END-READ
             PERFORM TF
              EVALUATE CHOIXMPREC
              WHEN 1
               PERFORM CRTPRECOM
              WHEN 2
               PERFORM SRCHPRECOM
              WHEN 9
               MOVE 1 TO FINPROGRAMME
              WHEN OTHER
               MOVE 'CE MENU N''EXISTE PAS' TO MSGERREUR
               PERFORM AFFICHERREUR
              END-EVALUATE
              INITIALIZE CHOIXMPREC
             END-IF
             END-PERFORM.
       CRTPRECOM.
            INITIALIZE E-ECRAN
            MOVE 1 TO INFOVALID
            MOVE 0 TO CPCLIENT OF MMPRECOMM
            MOVE 0 TO CPCLIENT OF MCPRECOMM
            WRITE E-ECRAN FORMAT 'MCPRECOMM' END-WRITE
            READ F-ECRAN END-READ
            PERFORM TF
            IF REFCLIENT OF MCPRECOMM = ALL SPACES
             IF NOMCLIENT OF MCPRECOMM = ALL SPACES
              MOVE 0 TO INFOVALID
             END-IF
             IF PRENCLIENT OF MCPRECOMM = ALL SPACES
              MOVE 0 TO INFOVALID
             END-IF
             IF ADRCLIENT OF MCPRECOMM = ALL SPACES
              MOVE 0 TO INFOVALID
             END-IF
             IF CPCLIENT OF MCPRECOMM = 0
              MOVE 0 TO INFOVALID
             END-IF
             IF VILCLIENT OF MCPRECOMM = ALL SPACES
              MOVE 0 TO INFOVALID
             END-IF
      *ICI ALLER CHERCHER LES INFO DANS LE FICHIER PF CLIENT DE PIERRE
      *PUIS REMPLACER LES INFO DU CLIENT PAR CELLE DU CLIENT ABONNE
            END-IF

            IF REFPRECOMM OF MCPRECOMM = ALL SPACES
             MOVE 0 TO INFOVALID
            END-IF
      *ICI VERIFIER SI LARTICLE EXISTE§
            IF REFARTICLE OF MCPRECOMM = ALL SPACES
             MOVE 0 TO INFOVALID
            END-IF
            IF INFOVALID = 0
             MOVE 'IL Y A UNE ERREUR' TO MSGERREUR
             PERFORM AFFICHERREUR
            ELSE
             OPEN I-O F-PRECOM
             MOVE MCPRECOMM TO PRECOMMAND
             WRITE E-PRECOM
              INVALID KEY
               MOVE 'L''ENREGISTREMENT EXISTE DEJA' TO MSGERREUR
               PERFORM AFFICHERREUR
              NOT INVALID KEY
               MOVE 'L''ENREGISTREMENT SEST BIEN DEROULÉ' TO MSGERREUR
               PERFORM AFFICHERREUR
             END-WRITE
             INITIALIZE E-PRECOM
             CLOSE F-PRECOM
            END-IF.
       MDFYPRECOM.
           WRITE E-ECRAN FORMAT 'MMPRECOMM' END-WRITE
           READ F-ECRAN END-READ
           PERFORM TF
           IF F4
            PERFORM DELPRECOMM
            ELSE
            MOVE 1 TO INFOVALID
             IF NOMCLIENT OF MMPRECOMM = ALL SPACES
              MOVE 0 TO INFOVALID
             END-IF
             IF PRENCLIENT OF MMPRECOMM = ALL SPACES
              MOVE 0 TO INFOVALID
             END-IF
             IF ADRCLIENT OF MMPRECOMM = ALL SPACES
              MOVE 0 TO INFOVALID
             END-IF
             IF CPCLIENT OF MMPRECOMM = 0
              MOVE 0 TO INFOVALID
             END-IF
             IF VILCLIENT OF MMPRECOMM = ALL SPACES
              MOVE 0 TO INFOVALID
             END-IF
      *ICI ALLER CHERCHER LES INFO DANS LE FICHIER PF CLIENT DE PIERRE
      *PUIS REMPLACER LES INFO DU CLIENT PAR CELLE DU CLIENT ABONNE
            IF REFPRECOMM OF MMPRECOMM = ALL SPACES
             MOVE 0 TO INFOVALID
            END-IF
      *ICI VERIFIER SI LARTICLE EXISTE§
            IF REFARTICLE OF MMPRECOMM = ALL SPACES
             MOVE 0 TO INFOVALID
            END-IF
            IF INFOVALID = 0
             MOVE 'IL Y A UNE ERREUR' TO MSGERREUR
             PERFORM AFFICHERREUR
            ELSE
             OPEN I-O F-PRECOM
             MOVE MMPRECOMM TO PRECOMMAND
             REWRITE E-PRECOM
              INVALID KEY
               MOVE 'L''ENREGISTREMENT N''EXISTE PAS' TO MSGERREUR
               PERFORM AFFICHERREUR
              NOT INVALID KEY
               MOVE 'LA MODIF S''EST BIEN DEROULE' TO MSGERREUR
               PERFORM AFFICHERREUR
             END-REWRITE
           END-IF
           INITIALIZE E-PRECOM
           END-IF
           INITIALIZE E-ECRAN.
       SRCHPRECOM.
           INITIALIZE E-ECRAN
           WRITE E-ECRAN FORMAT 'MRPRECOMMA' END-WRITE
           READ F-ECRAN END-READ
           IF REFPRECOMM OF MRPRECOMMA NOT = ALL SPACES
            OPEN I-O F-PRECOM
            MOVE REFPRECOMM OF MRPRECOMMA TO REFPRECOMM OF PRECOMMAND
            MOVE 1 TO TROUVE
            READ F-PRECOM
             INVALID KEY
              MOVE 0 TO TROUVE
              MOVE 'LA CLÉ N''EXISTE PAS' TO MSGERREUR
              PERFORM AFFICHERREUR
            END-READ
            IF TROUVE = 1
             MOVE PRECOMMAND TO MMPRECOMM
             PERFORM MDFYPRECOM
            END-IF
            CLOSE F-PRECOM
           ELSE
            MOVE 'VOUS DEVEZ ENTRER UNE REFERENCE §' TO MSGERREUR
            PERFORM AFFICHERREUR
           END-IF.
       DELPRECOMM.
           MOVE 'ETES VOUS SUR DE VOULOIR SUPPRIMER ?' TO MSGERREUR
           PERFORM AFFICHERREUR
           IF F4
            DELETE F-PRECOM
             INVALID KEY
              MOVE 'L''ENREGISTREMENT N''EXISTE PLUS' TO MSGERREUR
              PERFORM AFFICHERREUR
             NOT INVALID KEY
              MOVE 'L''ENREGISTREMENT A BIEN ETE SUPPRIME' TO MSGERREUR
              PERFORM AFFICHERREUR
            END-DELETE
           END-IF.
       AFFICHERREUR.
           IF FINPROGRAMME = 0
            WRITE E-ECRAN FORMAT 'ERREUR' END-WRITE
            READ F-ECRAN END-READ
            PERFORM TF
            INITIALIZE MSGERREUR
           END-IF.
       TF.
           IF F3
            MOVE 1 TO FINPROGRAMME
            GOBACK
           END-IF.
